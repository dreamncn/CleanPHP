---
title: 国密算法支持
date: 2022-05-12 12:34:01
permalink: /pages/68aea3/
author: 
  name: Ankio
  link: https://github.com/dreamncn
article: false


---

国密算法源自：[Github](https://github.com/lpilp/phpsm2sm3sm4)

此处进行了简单封装。

## SM3
::: tip 哈希计算
:::

```php
$data = "hello";
$hash = Encrypt::sm3($data);//调用
```
## SM4
::: tip 对称加密
:::

```php
$data = "hello";
//需要加密的数据
$key = "1234567812345678";
//16位加密key
$iv = "1234567812345678";
//16位偏移
$method = Encrypt::CBC;//其他加密模式请参考常量
//加密方式
$sm4 = Encrypt::sm4($key);

$hex = $sm4->encrypt($data,$method,$iv); //加密
$sm4->decrypt($hex,$method,$iv,'hex');//解密

```

## SM2

::: tip 非对称加密
:::

### 签名以及验签

```php

$sm2 = Encrypt::sm2(Encrypt::BASE64);//输出编码

$publicKey = '043d9d4cc71a285af936b36880fd4d6155c22957cd2c84ea313469065207fb951b9ef1db79d69af8886e91e833da1ebc6bfdde86e70f52923d6e042eaa147624c7'; // 公钥
$privateKey = 'a7763cd4fe7db2a2146fc09bf2d5e5a30e10c51b7e4bed00b3a26ec79ba78ff3'; // 私钥
$publicfile = "./data/sm2pub.pem";
$privatefile = "./data/sm2.pem";
$userId = '1234567812345678';
$document = "我爱你ILOVEYOU!";

  echo "\n----------生成明文密钥对--------------------------\n";
    print_r($sm2->generatekey()); //生成明文密钥
    echo "\n----------生成pem密钥对--------------------------\n";
    print_r($sm2->generatePemkey()); //生成pem密钥，请放到相应的文件中

 echo "\n---------明文密钥签名---------------------------\n";
    $sign = $sm2->doSign( $document, $privateKey, $userId);
    print_r($sign);
    echo "\n---------明文密钥验签---------------------------\n";
    var_dump($sm2->verifySign( $document, $sign, $publicKey, $userId ));

 echo "\n---------PEM密钥签名---------------------------\n";
    $sign = $sm2->doSignOutKey( $document, $privatefile, $userId);
    print_r($sign);
    echo "\n---------PEM密钥验签---------------------------\n";
    var_dump($sm2->verifySignOutKey( $document, $sign, $publicfile, $userId ));
```

### 加密以及解密

```php
$publicKey = '043d9d4cc71a285af936b36880fd4d6155c22957cd2c84ea313469065207fb951b9ef1db79d69af8886e91e833da1ebc6bfdde86e70f52923d6e042eaa147624c7'; // 公钥
$privateKey = 'a7763cd4fe7db2a2146fc09bf2d5e5a30e10c51b7e4bed00b3a26ec79ba78ff3'; // 私钥

$document = str_repeat('abcdef',70);
// sm2的非对称加解密，不建议加密太长的字符串
$m2EncryptData = $sm2 ->doEncrypt($document, $publicKey);
echo ("加密后: ".$m2EncryptData);
$m2DecryptData = $sm2->doDecrypt($m2EncryptData,$privateKey);
echo "\n===========\n";
echo ("解密后：".$m2DecryptData);
$document = "我爱你ILOVEYOU!";
echo "\n===========\n";
$m2EncryptData = $sm2 ->doEncrypt($document, $publicKey);
echo ("加密后: ".$m2EncryptData);
$m2DecryptData = $sm2->doDecrypt($m2EncryptData,$privateKey);
echo "\n===========\n";
echo ("解密后：".$m2DecryptData);
```
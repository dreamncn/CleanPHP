(window.webpackJsonp=window.webpackJsonp||[]).push([[43],{363:function(t,v,s){"use strict";s.r(v);var _=s(3),a=Object(_.a)({},(function(){var t=this,v=t._self._c;return v("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[v("p",[t._v("定时任务是个老生长谈的话题了，php也没有特别好的实现方案。")]),t._v(" "),v("p",[v("code",[t._v("CleanPHP")]),t._v("采用的是使用"),v("RouterLink",{attrs:{to:"/00.开发文档/08.常用工具类/05.后台任务类.html"}},[t._v("后台任务类")]),t._v("在后台拉起一个常驻进程，每隔10秒钟轮询任务列表。到达执行时间就执行。")],1),t._v(" "),v("div",{staticClass:"custom-block warning"},[v("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),v("p",[t._v("定时任务拓展是常驻进程，如果需要停止则需要重启PHP。")])]),t._v(" "),v("h2",{attrs:{id:"获取实例"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#获取实例"}},[t._v("#")]),t._v(" 获取实例")]),t._v(" "),v("p",[v("strong",[t._v("Tasker::getInstance")])]),t._v(" "),v("h2",{attrs:{id:"创建一个定时任务"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#创建一个定时任务"}},[t._v("#")]),t._v(" 创建一个定时任务")]),t._v(" "),v("p",[v("strong",[t._v("Tasker::add")])]),t._v(" "),v("table",[v("thead",[v("tr",[v("th",[t._v("参数")]),t._v(" "),v("th",[t._v("类型")]),t._v(" "),v("th",[t._v("解释")])])]),t._v(" "),v("tbody",[v("tr",[v("td",[t._v("$package")]),t._v(" "),v("td",[t._v("array")]),t._v(" "),v("td",[t._v("定时任务时间包")])]),t._v(" "),v("tr",[v("td",[t._v("$url")]),t._v(" "),v("td",[t._v("string")]),t._v(" "),v("td",[t._v("指定的任务类，使用"),v("a",{attrs:{href:"#%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E7%B1%BB"}},[t._v("定时任务类")]),t._v("构建")])]),t._v(" "),v("tr",[v("td",[t._v("$identify")]),t._v(" "),v("td",[t._v("string")]),t._v(" "),v("td",[t._v("定时任务名称或者定时任务参数")])]),t._v(" "),v("tr",[v("td",[t._v("$times")]),t._v(" "),v("td",[t._v("int")]),t._v(" "),v("td",[t._v("执行次数")])]),t._v(" "),v("tr",[v("td",[t._v("$loop")]),t._v(" "),v("td",[t._v("boolean")]),t._v(" "),v("td",[t._v("是否循环执行")])])])]),t._v(" "),v("div",{staticClass:"custom-block tip"},[v("p",{staticClass:"custom-block-title"},[t._v("执行次数与循环执行的区别")]),t._v(" "),v("p",[t._v("执行次数表示固定在某天某时执行。")]),t._v(" "),v("p",[t._v("循环执行表示以天、时、分秒作为执行周期，比如每天执行、每个星期执行。")])]),t._v(" "),v("div",{staticClass:"custom-block tip"},[v("p",{staticClass:"custom-block-title"},[t._v("返回值")]),t._v(" "),v("p",[t._v("返回定时任务ID")])]),t._v(" "),v("p",[v("strong",[t._v("定时任务时间包")])]),t._v(" "),v("h3",{attrs:{id:"cycle-day"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#cycle-day"}},[t._v("#")]),t._v(" Cycle::day")]),t._v(" "),v("div",{staticClass:"custom-block tip"},[v("p",{staticClass:"custom-block-title"},[t._v("设置缓存")])]),t._v(" "),v("table",[v("thead",[v("tr",[v("th",[t._v("参数")]),t._v(" "),v("th",[t._v("类型")]),t._v(" "),v("th",[t._v("解释")])])]),t._v(" "),v("tbody",[v("tr",[v("td",[t._v("$key")]),t._v(" "),v("td",[t._v("string")]),t._v(" "),v("td",[t._v("缓存名称")])]),t._v(" "),v("tr",[v("td",[t._v("$data")]),t._v(" "),v("td",[t._v("object")]),t._v(" "),v("td",[t._v("缓存的数据，任意类型都可以")])])])]),t._v(" "),v("h3",{attrs:{id:"cycle-day-2"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#cycle-day-2"}},[t._v("#")]),t._v(" Cycle::day")]),t._v(" "),v("div",{staticClass:"custom-block tip"},[v("p",{staticClass:"custom-block-title"},[t._v("以天为周期")])]),t._v(" "),v("table",[v("thead",[v("tr",[v("th",[t._v("参数")]),t._v(" "),v("th",[t._v("类型")]),t._v(" "),v("th",[t._v("解释")])])]),t._v(" "),v("tbody",[v("tr",[v("td",[t._v("$hour")]),t._v(" "),v("td",[t._v("int")]),t._v(" "),v("td",[t._v("小时")])]),t._v(" "),v("tr",[v("td",[t._v("$minute")]),t._v(" "),v("td",[t._v("int")]),t._v(" "),v("td",[t._v("分钟")])])])]),t._v(" "),v("h3",{attrs:{id:"cycle-nday"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#cycle-nday"}},[t._v("#")]),t._v(" Cycle::nDay")]),t._v(" "),v("div",{staticClass:"custom-block tip"},[v("p",{staticClass:"custom-block-title"},[t._v("以N天为周期")])]),t._v(" "),v("table",[v("thead",[v("tr",[v("th",[t._v("参数")]),t._v(" "),v("th",[t._v("类型")]),t._v(" "),v("th",[t._v("解释")])])]),t._v(" "),v("tbody",[v("tr",[v("td",[t._v("$day")]),t._v(" "),v("td",[t._v("int")]),t._v(" "),v("td",[t._v("天数")])]),t._v(" "),v("tr",[v("td",[t._v("$hour")]),t._v(" "),v("td",[t._v("int")]),t._v(" "),v("td",[t._v("小时")])]),t._v(" "),v("tr",[v("td",[t._v("$minute")]),t._v(" "),v("td",[t._v("int")]),t._v(" "),v("td",[t._v("分钟")])])])]),t._v(" "),v("h3",{attrs:{id:"cycle-nhour"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#cycle-nhour"}},[t._v("#")]),t._v(" Cycle::nHour")]),t._v(" "),v("div",{staticClass:"custom-block tip"},[v("p",{staticClass:"custom-block-title"},[t._v("以N小时为周期")])]),t._v(" "),v("table",[v("thead",[v("tr",[v("th",[t._v("参数")]),t._v(" "),v("th",[t._v("类型")]),t._v(" "),v("th",[t._v("解释")])])]),t._v(" "),v("tbody",[v("tr",[v("td",[t._v("$hour")]),t._v(" "),v("td",[t._v("int")]),t._v(" "),v("td",[t._v("小时")])]),t._v(" "),v("tr",[v("td",[t._v("$minute")]),t._v(" "),v("td",[t._v("int")]),t._v(" "),v("td",[t._v("分钟")])])])]),t._v(" "),v("h3",{attrs:{id:"cycle-hour"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#cycle-hour"}},[t._v("#")]),t._v(" Cycle::hour")]),t._v(" "),v("div",{staticClass:"custom-block tip"},[v("p",{staticClass:"custom-block-title"},[t._v("以小时为周期")])]),t._v(" "),v("table",[v("thead",[v("tr",[v("th",[t._v("参数")]),t._v(" "),v("th",[t._v("类型")]),t._v(" "),v("th",[t._v("解释")])])]),t._v(" "),v("tbody",[v("tr",[v("td",[t._v("$minute")]),t._v(" "),v("td",[t._v("int")]),t._v(" "),v("td",[t._v("分钟")])])])]),t._v(" "),v("h3",{attrs:{id:"cycle-nminute"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#cycle-nminute"}},[t._v("#")]),t._v(" Cycle::nMinute")]),t._v(" "),v("div",{staticClass:"custom-block tip"},[v("p",{staticClass:"custom-block-title"},[t._v("以N分钟为周期")])]),t._v(" "),v("table",[v("thead",[v("tr",[v("th",[t._v("参数")]),t._v(" "),v("th",[t._v("类型")]),t._v(" "),v("th",[t._v("解释")])])]),t._v(" "),v("tbody",[v("tr",[v("td",[t._v("$minute")]),t._v(" "),v("td",[t._v("int")]),t._v(" "),v("td",[t._v("分钟")])])])]),t._v(" "),v("h3",{attrs:{id:"cycle-week"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#cycle-week"}},[t._v("#")]),t._v(" Cycle::week")]),t._v(" "),v("div",{staticClass:"custom-block tip"},[v("p",{staticClass:"custom-block-title"},[t._v("以周为周期")])]),t._v(" "),v("table",[v("thead",[v("tr",[v("th",[t._v("参数")]),t._v(" "),v("th",[t._v("类型")]),t._v(" "),v("th",[t._v("解释")])])]),t._v(" "),v("tbody",[v("tr",[v("td",[t._v("$week")]),t._v(" "),v("td",[t._v("int")]),t._v(" "),v("td",[t._v("周数")])]),t._v(" "),v("tr",[v("td",[t._v("$hour")]),t._v(" "),v("td",[t._v("int")]),t._v(" "),v("td",[t._v("小时")])]),t._v(" "),v("tr",[v("td",[t._v("$minute")]),t._v(" "),v("td",[t._v("int")]),t._v(" "),v("td",[t._v("分钟")])])])]),t._v(" "),v("h3",{attrs:{id:"cycle-month"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#cycle-month"}},[t._v("#")]),t._v(" Cycle::month")]),t._v(" "),v("div",{staticClass:"custom-block tip"},[v("p",{staticClass:"custom-block-title"},[t._v("以月为周期")])]),t._v(" "),v("table",[v("thead",[v("tr",[v("th",[t._v("参数")]),t._v(" "),v("th",[t._v("类型")]),t._v(" "),v("th",[t._v("解释")])])]),t._v(" "),v("tbody",[v("tr",[v("td",[t._v("$day")]),t._v(" "),v("td",[t._v("int")]),t._v(" "),v("td",[t._v("天数")])]),t._v(" "),v("tr",[v("td",[t._v("$hour")]),t._v(" "),v("td",[t._v("int")]),t._v(" "),v("td",[t._v("小时")])]),t._v(" "),v("tr",[v("td",[t._v("$minute")]),t._v(" "),v("td",[t._v("int")]),t._v(" "),v("td",[t._v("分钟")])])])]),t._v(" "),v("h2",{attrs:{id:"获取定时任务列表"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#获取定时任务列表"}},[t._v("#")]),t._v(" 获取定时任务列表")]),t._v(" "),v("p",[v("strong",[t._v("Tasker::list")])]),t._v(" "),v("h2",{attrs:{id:"删除一个定时任务"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#删除一个定时任务"}},[t._v("#")]),t._v(" 删除一个定时任务")]),t._v(" "),v("p",[v("strong",[t._v("Tasker::del")])]),t._v(" "),v("table",[v("thead",[v("tr",[v("th",[t._v("参数")]),t._v(" "),v("th",[t._v("类型")]),t._v(" "),v("th",[t._v("解释")])])]),t._v(" "),v("tbody",[v("tr",[v("td",[t._v("$id")]),t._v(" "),v("td",[t._v("string")]),t._v(" "),v("td",[t._v("定时任务ID")])])])]),t._v(" "),v("h2",{attrs:{id:"获取一个定时任务"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#获取一个定时任务"}},[t._v("#")]),t._v(" 获取一个定时任务")]),t._v(" "),v("p",[v("strong",[t._v("Tasker::get")])]),t._v(" "),v("table",[v("thead",[v("tr",[v("th",[t._v("参数")]),t._v(" "),v("th",[t._v("类型")]),t._v(" "),v("th",[t._v("解释")])])]),t._v(" "),v("tbody",[v("tr",[v("td",[t._v("$id")]),t._v(" "),v("td",[t._v("string")]),t._v(" "),v("td",[t._v("定时任务ID")])])])]),t._v(" "),v("h2",{attrs:{id:"定时任务类"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#定时任务类"}},[t._v("#")]),t._v(" 定时任务类")]),t._v(" "),v("blockquote",[v("p",[t._v("定时任务类需要继承"),v("code",[t._v("extend\\ankioTask\\task\\ATasker")]),t._v("并实现下面三种方法")])]),t._v(" "),v("div",{staticClass:"language-php line-numbers-mode"},[v("pre",{pre:!0,attrs:{class:"language-php"}},[v("code",[v("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),v("span",{pre:!0,attrs:{class:"token class-name-definition class-name"}},[t._v("TestTask")]),t._v(" "),v("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),v("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ATasker")]),t._v("\n"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),v("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),v("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),v("span",{pre:!0,attrs:{class:"token function-definition function"}},[t._v("onStart")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),v("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//任务执行")]),t._v("\n    "),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),v("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),v("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),v("span",{pre:!0,attrs:{class:"token function-definition function"}},[t._v("onStop")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),v("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//任务结束")]),t._v("\n    "),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),v("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),v("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),v("span",{pre:!0,attrs:{class:"token function-definition function"}},[t._v("onAbort")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),v("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$e")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),v("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//任务异常退出，$e是告警信息")]),t._v("\n    "),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])]),t._v(" "),v("div",{staticClass:"line-numbers-wrapper"},[v("span",{staticClass:"line-number"},[t._v("1")]),v("br"),v("span",{staticClass:"line-number"},[t._v("2")]),v("br"),v("span",{staticClass:"line-number"},[t._v("3")]),v("br"),v("span",{staticClass:"line-number"},[t._v("4")]),v("br"),v("span",{staticClass:"line-number"},[t._v("5")]),v("br"),v("span",{staticClass:"line-number"},[t._v("6")]),v("br"),v("span",{staticClass:"line-number"},[t._v("7")]),v("br"),v("span",{staticClass:"line-number"},[t._v("8")]),v("br"),v("span",{staticClass:"line-number"},[t._v("9")]),v("br"),v("span",{staticClass:"line-number"},[t._v("10")]),v("br"),v("span",{staticClass:"line-number"},[t._v("11")]),v("br"),v("span",{staticClass:"line-number"},[t._v("12")]),v("br"),v("span",{staticClass:"line-number"},[t._v("13")]),v("br"),v("span",{staticClass:"line-number"},[t._v("14")]),v("br"),v("span",{staticClass:"line-number"},[t._v("15")]),v("br"),v("span",{staticClass:"line-number"},[t._v("16")]),v("br"),v("span",{staticClass:"line-number"},[t._v("17")]),v("br"),v("span",{staticClass:"line-number"},[t._v("18")]),v("br")])]),v("blockquote",[v("p",[t._v("定时任务的相关参数如下：")])]),t._v(" "),v("table",[v("thead",[v("tr",[v("th",[t._v("参数")]),t._v(" "),v("th",[t._v("类型")]),t._v(" "),v("th",[t._v("解释")])])]),t._v(" "),v("tbody",[v("tr",[v("td",[t._v("task_id")]),t._v(" "),v("td",[t._v("string")]),t._v(" "),v("td",[t._v("定时任务ID")])]),t._v(" "),v("tr",[v("td",[t._v("task_url")]),t._v(" "),v("td",[t._v("string")]),t._v(" "),v("td",[t._v("定时任务的具体实现类名")])]),t._v(" "),v("tr",[v("td",[t._v("task_name")]),t._v(" "),v("td",[t._v("string")]),t._v(" "),v("td",[t._v("传递给这个定时任务的数据")])])])]),t._v(" "),v("p",[t._v("可以在"),v("code",[t._v("ATasker")]),t._v("类中使用"),v("code",[t._v("arg()")]),t._v("函数来获取定时任务的参数。")])])}),[],!1,null,null,null);v.default=a.exports}}]);